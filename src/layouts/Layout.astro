---
// src/layouts/layout.astro
interface Props {
  title?: string;
}

const { title = "Héritage Vodun" } = Astro.props;
---

<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="description"
      content="Découvrez l'essence du Vodun, spiritualité millénaire du Bénin."
    />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>

    <script type="text/javascript">
      function googleTranslateElementInit() {
        new google.translate.TranslateElement(
          {
            pageLanguage: "fr",
            includedLanguages: "en,fr",
            layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
            autoDisplay: false,
          },
          "google_translate_element"
        );
      }
    </script>
    <script
      type="text/javascript"
      src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"
    ></script>
  </head>

  <body>
    <div id="google_translate_element"></div>

    <slot />

    <script>
      // Fonction pour changer la langue
      function triggerTranslation() {
        // ICI LA CORRECTION : On précise "as HTMLSelectElement" pour éviter l'erreur rouge
        const googleSelect = document.querySelector(
          ".goog-te-combo"
        ) as HTMLSelectElement;

        if (googleSelect) {
          googleSelect.value = "en";
          googleSelect.dispatchEvent(new Event("change", { bubbles: true }));
        }
      }

      // On attend que tout soit prêt
      ["DOMContentLoaded", "astro:page-load"].forEach((event) => {
        document.addEventListener(event, () => {
          const btn = document.getElementById("translate-btn");

          if (btn) {
            btn.addEventListener("click", (e) => {
              e.preventDefault();
              triggerTranslation();

              // Sécurité : on réessaie après 1 seconde
              setTimeout(triggerTranslation, 1000);
            });
          }
        });
      });
    </script>
  </body>
</html>

<style is:global>
  /* --- STABILITÉ ET PROPRETÉ --- */
  html,
  body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow-x: hidden;
  }
  html {
    margin-top: 0 !important;
  }
  body {
    top: 0 !important;
  }

  /* Cache visuel complet de Google */
  .goog-te-banner-frame.skiptranslate {
    display: none !important;
  }
  body > .skiptranslate {
    display: none !important;
  }
  #goog-gt-tt,
  .goog-te-balloon-frame {
    display: none !important;
  }
  .goog-logo-link {
    display: none !important;
  }
  .goog-te-gadget {
    color: transparent !important;
  }

  /* Le widget technique reste présent mais invisible */
  #google_translate_element {
    visibility: hidden;
    position: absolute;
    width: 1px;
    height: 1px;
    top: 0;
    left: 0;
    z-index: -1;
  }
</style>
